# リファクタリング計画

## 定期コードリファクタリング依頼（作業ブランチ対象）

**現在チェックアウトしている作業ブランチ**での変更差分とその周辺コードを対象に、次の条件でリファクタリングの提案・修正案を出してください。

### ゴール
- 挙動や仕様を変えずに、**可読性・保守性・拡張性**を高める。
- 変更範囲は、**このブランチで追加・変更されたファイルおよびその周辺ロジック**を主対象とする。

### 事前確認
1. `git diff main...HEAD --name-only` で変更ファイル一覧を取得
2. `git diff main...HEAD` で具体的な差分を確認
3. 上記をもとに対象範囲を特定する

### 対象範囲
- このブランチで追加・変更されたファイル
- 上記ファイルが直接 import/依存しているモジュール（1階層まで）
- 同一ディレクトリ内の関連ファイル

### 除外対象
- 自動生成されたコード（`*.generated.*`, `dist/`, `build/`）
- 外部ライブラリ（`node_modules/`, `vendor/`）
- 設定ファイル（`*.config.js` など）
- テストコード（別途指示がない限り）

### 前提・設計ルール
次の開発設計ルールに沿って判断してください。

- **原則**
  - 関心を分離して影響範囲を限定する  
  - 高凝集にして内部変更を容易にする  
  - 疎結合にして依存関係を減らす  
  - 抽象化して変更耐性を高める  
  - 非冗長にして重複を排除する  

- **構造**
  - 同一関心のファイルが 3 件以上になった場合は専用ディレクトリを作成し階層化する  

- **実装指針**
  - シンプルを最優先とする  
  - オーバーエンジニアリング禁止  
  - 常に最小限で設計・実装する  
  - ファイルの細分化を避け、過剰な場合は統合する  

- **運用**
  - 現在のブランチにおける変更部分を重点的に確認する  

### リファクタリング方針（優先順位順）
1. **不要なものの削除**
   - 未使用コード・コメントアウトされた古いコード・未使用 import / 変数を整理する。
2. **重複コードの削減**
   - 共通化できる処理は関数化・コンポーネント化する。
3. **ロジックの単純化**
   - ネストや条件分岐が深い箇所を分割・整理し、読みやすくする。
4. **責務の明確化**
   - 1つの関数・クラス・コンポーネントが多責務になっていないか確認し、適切に分割または整理する。
5. **ネーミング改善**
   - 変数名・関数名・クラス名を、意図が伝わる名前に改善する。
6. **型・Lint**
   - 型エラー・Lint エラーを増やさないこと。可能なら減らす方向で調整する。

**注意**: 挙動・外部 API・公開インターフェースは変更しないこと。仕様変更が望ましいと判断した場合は、まず「指摘・提案」のみにとどめる。

### 変更量の目安
- 1回の提案で変更するファイルは **5ファイル以内** を目安とする
- 大規模な変更が必要な場合は、フェーズを分けて段階的に提案する

### 実行フロー
1. 対象ファイルの一覧と変更概要を**先に提示**
2. ユーザーの承認後、具体的なコード変更を実施
3. 懸念点や影響範囲が大きい場合は、個別に確認を求める

### アウトプット形式
1. **対象範囲の明示**
   - どのファイルの、どの箇所を対象にしたか（ファイルパスと簡単な説明）。
2. **具体的なリファクタリング提案**
   - 変更前後のコード抜粋、または擬似的な差分の形で示す。
3. **意図とメリット**
   - なぜその変更が必要か、どんなメリット（可読性・保守性・バグ耐性など）があるかを簡潔に説明する。
4. **追加の改善余地（任意）**
   - 今回手を入れていないが、今後改善すると良さそうな箇所があればコメントする。

---

※リポジトリ全体を対象にしたい場合は、この依頼文の前に次を付けてください。  
「**このルールに基づいてリポジトリ全体を対象にリファクタリングして。**」
