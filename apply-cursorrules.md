# apply-cursorrules

次のリポジトリから最新のCursorrulesを取得し、本プロジェクトに適用してください。
https://github.com/kinopeee/cursorrules

公式READMEの手順に従い、日本語版の設定（`ja/.cursor`フォルダ）をプロジェクトにコピーします。

## 前提条件

1. **Gitの状態確認**
   - 作業ディレクトリがクリーンであること（未コミットの変更がないこと）
   - 必要に応じて `git status` で確認
   - 未コミットの変更がある場合は、事前にコミットまたはstashする

2. **ブランチ確認**
   - 現在のブランチが `main` であること
   - 必要に応じて `git checkout main` で切り替え

3. **リモートとの同期**
   - `git pull origin main` で最新の状態に更新しておく

4. **ネットワーク接続**
   - GitHubへのアクセスが可能であること

5. **実行場所**
   - このカスタムコマンドは、Cursorrulesを適用するプロジェクトのルートディレクトリで実行すること

## 実行手順

### ステップ1: リポジトリのクローン

1. プロジェクトルートで一時的にリポジトリをクローン
   ```bash
   git clone https://github.com/kinopeee/cursorrules.git
   ```
   - これにより、カレントディレクトリに `cursorrules` フォルダが作成されます

2. クローンしたリポジトリの構造を確認
   - `cursorrules/ja/.cursor/` ディレクトリが存在することを確認
   - このディレクトリには `rules/` と `commands/` が含まれます

### ステップ2: プロジェクトへの適用

1. **`.cursor` ディレクトリのコピー**
   - 日本語版の設定をプロジェクトにコピー
   ```bash
   cp -r cursorrules/ja/.cursor .
   ```
   - これにより、プロジェクトルートに `.cursor/` ディレクトリが作成または更新されます
   - 既存の `.cursor/` ディレクトリがある場合は、内容が上書きされます

2. **コピー結果の確認**
   - `.cursor/rules/` ディレクトリが存在することを確認
   - `.cursor/commands/` ディレクトリが存在することを確認
   - 必要に応じて、ファイル一覧を確認

3. **一時ディレクトリの削除（任意）**
   ```bash
   rm -rf cursorrules
   ```
   - クローンしたリポジトリは不要になったため削除できます

### ステップ3: Git操作

1. **変更の確認**
   - `git status` で変更されたファイルを確認
   - `.cursor/` 配下のファイル（`rules/` と `commands/` を含む）が変更されていることを確認

2. **コミット**
   - コミットメッセージの書式は `.cursor/rules/commit-message-format.mdc` のルール（Prefix + サマリ + 箇条書き、日本語）に従って作成する
   - コミットおよびプッシュの実行方法は、カスタムコマンド `/commit-push` のルール（`commit-push.md`）に従う
   - ローカルで手動実行する場合の一例:
     ```bash
     git add .cursor/
     git commit
     ```
   - エディタで開いたコミットメッセージに、上記ルールに沿ってサマリと箇条書き本文を記述する

3. **プッシュ**
   - `git push origin main` でリモートに反映

### ステップ4: 検証

1. **ファイルの存在確認**
   - `.cursor/rules/` 配下に期待されるファイルが存在するか確認
   - `.cursor/commands/` 配下に期待されるファイルが存在するか確認

2. **Git履歴の確認**
   - `git log -1` で最新のコミットが正しく作成されているか確認

3. **リモート反映の確認**
   - GitHub等でリモートリポジトリに変更が反映されているか確認（任意）

## エラーハンドリング

### ケース1: リポジトリのクローンに失敗
- **原因**: ネットワークエラー、認証エラー、リポジトリが存在しない
- **対処**: エラーメッセージを確認し、手動でリポジトリを確認
  - リポジトリURL: https://github.com/kinopeee/cursorrules

### ケース2: `ja/.cursor` ディレクトリが見つからない
- **原因**: リポジトリの構造が変更された、`ja/` ディレクトリが存在しない
- **対処**: リポジトリの構造を確認し、正しいパスを特定
  - リポジトリのREADMEを確認: https://github.com/kinopeee/cursorrules

### ケース3: 既存ファイルとの競合
- **原因**: 既存の `.cursor/` ディレクトリに手動で変更が加えられている
- **対処**: 
  - 差分を確認（`git diff .cursor/`）
  - 必要に応じて手動でマージ
  - または既存ファイルをバックアップしてから上書き
  ```bash
  # バックアップ例
  cp -r .cursor .cursor.backup
  cp -r cursorrules/ja/.cursor .
  ```

### ケース4: Git操作の失敗
- **原因**: ブランチが `main` でない、リモートとの競合、権限エラー
- **対処**: 
  - エラーメッセージを確認
  - 必要に応じて `git pull` で最新化してから再試行
  - 権限エラーの場合は、リモートへのpush権限を確認

### ケース5: コミットメッセージの形式エラー
- **原因**: `/commit` コマンドのルールに準拠していない
- **対処**: `/commit` コマンドのルールを確認し、正しい形式で再コミット

## ロールバック手順（問題が発生した場合）

1. **直前のコミットを取り消し**
   ```bash
   git reset --soft HEAD~1  # コミットのみ取り消し（変更は保持）
   # または
   git reset --hard HEAD~1  # コミットと変更を完全に取り消し
   ```

2. **リモートに既にpushしている場合**
   ```bash
   git revert HEAD
   git push origin main
   ```

3. **ファイルを手動で削除または復元**
   - `.cursor/` ディレクトリを削除または元の状態に戻す
   - バックアップを作成していた場合は、そこから復元

## 注意事項

- このコマンドは `.cursor/` 配下のファイル全体（`rules/` と `commands/` を含む）を変更します
- 既存のプロジェクト固有のルールファイルやコマンドファイルがある場合は、上書きされる可能性があります
- 初回実行時は `.cursor/` ディレクトリが作成されます
- 既存の `.cursor/` ディレクトリがある場合、内容は完全に置き換えられます
- 重要なカスタマイズがある場合は、事前にバックアップを取ることを推奨します

## 実行後の確認事項

- [ ] `cursorrules/ja/.cursor` が正しくコピーされている
- [ ] `.cursor/rules/` 配下に期待されるファイルが存在する
- [ ] `.cursor/commands/` 配下に期待されるファイルが存在する
- [ ] Gitの変更が期待通りである（`.cursor/` 配下のみ）
- [ ] コミットメッセージが `/commit` コマンドのルールに準拠している
- [ ] リモートに正しくpushされている
- [ ] エラーや警告が発生していない
