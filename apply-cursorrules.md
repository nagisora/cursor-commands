# apply-cursorrules

私の管理する以下のリポジトリから最新のCursorrulesを取得し、本プロジェクトに適用してください。
https://github.com/nagisora/cursorrules

## 前提条件

1. **Gitの状態確認**
   - 作業ディレクトリがクリーンであること（未コミットの変更がないこと）
   - 必要に応じて `git status` で確認
   - 未コミットの変更がある場合は、事前にコミットまたはstashする

2. **ブランチ確認**
   - 現在のブランチが `main` であること
   - 必要に応じて `git checkout main` で切り替え

3. **リモートとの同期**
   - `git pull origin main` で最新の状態に更新しておく

4. **ネットワーク接続**
   - GitHubへのアクセスが可能であること

## 実行手順

### ステップ1: リポジトリからファイルを取得

1. 一時ディレクトリを作成（例: `/tmp/cursorrules-temp`）
2. GitHubリポジトリをクローンまたは最新のファイルを取得
   - 方法A: `git clone https://github.com/nagisora/cursorrules.git /tmp/cursorrules-temp`（初回のみ）
   - 方法B: 既にクローン済みの場合は `git pull` で最新化
3. ソースディレクトリ: `/tmp/cursorrules-temp/.cursor/rules/` を確認

### ステップ2: 適用対象ファイルの特定

1. `.cursor/rules/` ディレクトリ内の全ファイルをリストアップ
2. 末尾が `.en.mdc` で**ない**ファイル（日本語ファイル）を抽出
   - 例: `v5.md`, `test-strategy.md` などは適用対象
   - 例: `v5.en.mdc`, `test-strategy.en.mdc` などは除外
3. 適用対象ファイルの一覧を確認・表示

### ステップ3: プロジェクトへの適用

1. **`.cursor/rules/` ディレクトリの作成**
   - プロジェクトルートに `.cursor/rules/` ディレクトリが存在しない場合は作成
   - 既存の場合は、既存ファイルのバックアップを推奨（任意）

2. **ファイルのコピー**
   - ソース: `/tmp/cursorrules-temp/.cursor/rules/[対象ファイル名]`
   - 先: `[プロジェクトルート]/.cursor/rules/[対象ファイル名]`
   - 既存ファイルがある場合は上書き（差分がある場合のみ）

3. **ファイル内容の確認**
   - コピーしたファイルが正しく配置されているか確認
   - ファイルサイズや行数で簡易検証

### ステップ4: Git操作

1. **変更の確認**
   - `git status` で変更されたファイルを確認
   - `.cursor/rules/` 配下のファイルのみが変更されていることを確認

2. **コミット**
   - カスタムコマンド `/commit` のルールに準拠してコミットメッセージを作成
   - `/commit` コマンドのルールが不明な場合は、以下の形式を推奨:
     - タイトル: `chore: update cursorrules from nagisora/cursorrules`
     - 本文: 適用したファイルの一覧を記載
   - `git add .cursor/rules/`
   - `git commit -m "[コミットメッセージ]"`

3. **マージ**
   - 現在 `main` ブランチにいる場合はマージは不要
   - 別ブランチにいる場合は `main` にマージ（このコマンドでは `main` で実行する前提）

4. **プッシュ**
   - `git push origin main` でリモートに反映

### ステップ5: 検証

1. **ファイルの存在確認**
   - `.cursor/rules/` 配下に期待されるファイルが存在するか確認

2. **Git履歴の確認**
   - `git log -1` で最新のコミットが正しく作成されているか確認

3. **リモート反映の確認**
   - GitHub等でリモートリポジトリに変更が反映されているか確認（任意）

## エラーハンドリング

### ケース1: リポジトリのクローンに失敗
- **原因**: ネットワークエラー、認証エラー、リポジトリが存在しない
- **対処**: エラーメッセージを確認し、手動でリポジトリを確認

### ケース2: 適用対象ファイルが見つからない
- **原因**: リポジトリの構造が変更された、`.cursor/rules/` ディレクトリが存在しない
- **対処**: リポジトリの構造を確認し、正しいパスを特定

### ケース3: 既存ファイルとの競合
- **原因**: 既存ファイルに手動で変更が加えられている
- **対処**: 
  - 差分を確認（`git diff`）
  - 必要に応じて手動でマージ
  - または既存ファイルをバックアップしてから上書き

### ケース4: Git操作の失敗
- **原因**: ブランチが `main` でない、リモートとの競合、権限エラー
- **対処**: 
  - エラーメッセージを確認
  - 必要に応じて `git pull` で最新化してから再試行
  - 権限エラーの場合は、リモートへのpush権限を確認

### ケース5: コミットメッセージの形式エラー
- **原因**: `/commit` コマンドのルールに準拠していない
- **対処**: `/commit` コマンドのルールを確認し、正しい形式で再コミット

## ロールバック手順（問題が発生した場合）

1. **直前のコミットを取り消し**
   git reset --soft HEAD~1  # コミットのみ取り消し（変更は保持）
   # または
   git reset --hard HEAD~1  # コミットと変更を完全に取り消し
   
2. **リモートに既にpushしている場合**
   git revert HEAD
   git push origin main
   3. **ファイルを手動で削除**
   - `.cursor/rules/` ディレクトリを削除または元の状態に戻す

## 注意事項

- このコマンドは `.cursor/rules/` 配下のファイルのみを変更します
- 既存のプロジェクト固有のルールファイルがある場合は、上書きされる可能性があります
- 初回実行時は `.cursor/rules/` ディレクトリが作成されます
- 軽微な修正と記載されていますが、実際の変更内容はリポジトリの更新内容に依存します

## 実行後の確認事項

- [ ] 適用対象ファイルが正しくコピーされている
- [ ] Gitの変更が期待通りである（`.cursor/rules/` 配下のみ）
- [ ] コミットメッセージが `/commit` コマンドのルールに準拠している
- [ ] リモートに正しくpushされている
- [ ] エラーや警告が発生していない